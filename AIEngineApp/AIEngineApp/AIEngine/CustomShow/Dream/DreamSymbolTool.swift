import Foundation
import FoundationModels

struct DreamSymbolTool: Tool {
    let name = "getDreamSymbolMeaning"
    let description = "查询一个特定的梦境符号（物体、动物、行为等）在心理学和不同文化中的普遍象征意义。"

    @Generable
    struct Arguments {
        @Guide(description: "需要查询含义的梦中符号，例如 '水', '蛇', '飞翔', '坠落', '房子'。")
        var symbolName: String
    }

    typealias Output = String

    func call(arguments: Arguments) async throws -> String {
        // 为了演示和扩展，我们扩充了这个字典数据源。
        // 在真实应用中，这些数据可以来自一个本地的JSON文件或数据库。
        let symbolDictionary: [String: String] = [
            // == 行为/事件 ==
            "飞翔": "飞翔通常象征着自由、超越束缚、获得新视角或掌控感。但也可能反映了逃避现实的倾向。",
            "坠落": "从高处坠落的梦境常常与现实生活中的失控感、不安全感或缺乏支持有关。它也可能象征着在某段关系或某个项目中对失败的恐惧。",
            "被追": "梦见被追逐通常反映了现实生活中的压力、恐惧或逃避行为。追逐你的东西可能象征着你不想面对的情绪、责任或某个特定的人。",
            "追逐": "梦见被追逐通常反映了现实生活中的压力、恐惧或逃避行为。追逐你的东西可能象征着你不想面对的情绪、责任或某个特定的人。",
            "考试": "梦见考试，尤其是在毫无准备的情况下，通常代表着在现实生活中感到被审视、评判，或对自己当前的能力缺乏信心，反映了对失败的焦虑。",
            "迟到": "梦见迟到可能暗示着你担心错失某个机会，或者感觉自己在现实生活中跟不上节奏、压力过大，无法履行自己的承诺。",
            "迷路": "梦见迷路反映了你在现实生活中可能感到的困惑、不确定或失去了方向感。你可能正在面临一个重要的选择，或者不清楚自己的人生目标。",
            "死亡": "梦见死亡很少预示着真正的死亡。它通常象征着结束和重生。这可能代表着一段关系的终结、旧习惯的改变，预示着新的开始。",

            // == 动物 ==
            "水": "水常常代表着情绪和潜意识。清澈的水可能表示情绪平和，而浑浊或汹涌的水可能代表着混乱的情绪或压抑的感情。",
            "蛇": "蛇在不同文化中有多重含义。它可以代表危险、恐惧、欺骗，也可以象征着疗愈、重生、智慧和转变。",
            "狗": "狗在梦中通常象征着忠诚、友谊和保护。友善的狗代表着和谐的人际关系，而具有攻击性的狗则可能暗示着背叛、冲突或内心的挣扎。",
            "猫": "猫常常代表着独立、直觉、阴性力量和神秘。梦见猫可能是在提醒你要相信自己的直觉，或者关注自己独立自主的一面。",
            "蜘蛛": "蜘蛛在梦中可以象征创造力（编织的网），也可以代表恐惧或被束缚的感觉。具体含义取决于你对蜘蛛的个人感受和梦中的情境。",
            "鸟": "鸟类通常与希望、自由、灵感和超越联系在一起。飞翔的鸟象征着好消息或目标的实现，而被困的鸟则可能代表着束缚和限制。",
            "鱼": "鱼生活在水中，因此常常与潜意识、情绪和直觉有关。梦见鱼可能预示着财富、怀孕，或者代表着你内心深处未被发现的洞察力。",

            // == 物品/地点 ==
            "掉牙": "梦见掉牙是一种常见的焦虑梦，可能与对个人外表、沟通能力的担忧有关，也可能象征着失控感或生命中的重要变化。",
            "牙齿": "梦见掉牙是一种常见的焦虑梦，可能与对个人外表、沟通能力的担忧有关，也可能象征着失控感或生命中的重要变化。",
            "房子": "房子在梦中通常是你内心的象征。房子的不同房间可以代表你个性的不同方面。房子的状况（整洁、破旧、空旷）反映了你当下的心理状态。",
            "车": "汽车或交通工具通常象征着你人生的道路和前进的方向。驾驶汽车代表你对自己生活的掌控程度，而车辆的状况则反映了你实现目标的动力和能力。",
            "汽车": "汽车或交通工具通常象征着你人生的道路和前进的方向。驾驶汽车代表你对自己生活的掌控程度，而车辆的状况则反映了你实现目标的动力和能力。",
            "钱": "梦见金钱通常与自信、力量、自我价值感和机会有关。捡到钱可能代表着获得了新的自信或机会，而丢钱则可能暗示着对失去价值或安全感的担忧。",
            "镜子": "镜子反映了你的自我认知和形象。在镜子中看到自己，是在提醒你进行自我反思。镜中扭曲或模糊的影像可能表示自我认知上的困惑或不确定。",
            
            // == 人物/状态 ==
            "婴儿": "婴儿在梦中通常象征着新的开始、新的想法、潜力或纯真。它可能代表着一个新的项目，或者你个性中需要被关爱和培养的脆弱一面。",
            "裸体": "在公共场合裸体的梦境非常常见，通常与脆弱、羞耻、被暴露或害怕被评判的心理有关。这也可能代表着你希望在某方面能更坦诚、更真实地做自己。",
            "裸露": "在公共场合裸体的梦境非常常见，通常与脆弱、羞耻、被暴露或害怕被评判的心理有关。这也可能代表着你希望在某方面能更坦诚、更真实地做自己。"
        ]
        
        // 为了让查询更灵活，我们将用户的输入和字典的键都转换为小写进行比较。
        let normalizedSymbol = arguments.symbolName.lowercased()
        
        // 查找匹配的键
        let matchedKey = symbolDictionary.keys.first { $0.lowercased() == normalizedSymbol }
                
        if let key = matchedKey, let meaning = symbolDictionary[key] {
            return meaning
        } else {
            // 如果找不到，返回一个默认提示。
            return "抱歉，我的知识库里暂时没有关于'\(arguments.symbolName)'的详细解释。"
        }
    }
}
